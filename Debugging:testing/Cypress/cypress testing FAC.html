<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing with Cypress</title>
    <link
      rel="preload"
      href="/assets/fonts/GT-Eesti-Text-Light-subset.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link rel="icon" href="/assets/favicon.svg" />
    <link href="/assets/css/styles.css" rel="stylesheet" />
  </head>
  <body>
    <div>
      <header class="hstack jc-between pad-lg">
        <a href="/" aria-label="Home"
          ><img src="/assets/images/logo.svg" width="100" alt
        /></a>
        <nav id="global-nav">
          <ul role="list" class="hstack">
            <li>
              <a class="global-nav__link" href="/course/introduction/"
                >Course</a
              >
            </li>
            <li>
              <a class="global-nav__link" href="/resources/introduction/"
                >Resources</a
              >
            </li>
            <li><a class="global-nav__link" href="/about/">About</a></li>
          </ul>
        </nav>
      </header>
      <div class="center">
        <div class="layout">
          <aside></aside>
          <main id="main">
            <div>
              <header class="vstack gap-xl pad-xl stripes">
                <div class="vstack" data-gap="md">
                  <h1 class="highlight bg-primary">Testing with Cypress</h1>
                  <p class="highlight fz-lg">
                    Learn how to use Cypress to test your app in a real browser
                  </p>
                  <ul role="list" class="hstack gap-sm wrap">
                    <li
                      class="highlight fz-sm fw-bold"
                      style="--bg: var(--bg-400)"
                    >
                      testing
                    </li>
                    <li
                      class="highlight fz-sm fw-bold"
                      style="--bg: var(--bg-400)"
                    >
                      cypress
                    </li>
                  </ul>
                </div>
                <div class="hstack wrap">
                  <div class="vstack gap-none">
                    <label
                      for="download-command"
                      class="highlight fw-bold"
                      style="--bg: var(--bg-400)"
                      >Download files via CLI</label
                    ><copy-text class="hstack gap-none ai-stretch"
                      ><input
                        id="download-command"
                        readonly
                        value="npx degit 'foundersandcoders/coursebook/src/workshops/cypress-testing/starter-files#main' cypress-testing" /><button
                        aria-label="Copy"
                        title="Copy"
                        hidden
                      >
                        <svg
                          data-copy
                          width="20"
                          height="20"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                          ></path></svg
                        ><svg
                          hidden
                          data-success
                          width="20"
                          height="20"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 13l4 4L19 7"
                          ></path>
                        </svg></button
                    ></copy-text>
                  </div>
                  <a
                    href="https://github.com/foundersandcoders/coursebook/issues/new?title=%5Bworkshops%2Fcypress-testing%5D&amp;labels=feedback"
                    target="_blank"
                    rel="noopener"
                    class="button"
                    >Leave feedback<svg
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      width="16"
                      height="16"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10 2c-2.236 0-4.43.18-6.57.524C1.993 2.755 1 4.014 1 5.426v5.148c0 1.413.993 2.67 2.43 2.902 1.168.188 2.352.327 3.55.414.28.02.521.18.642.413l1.713 3.293a.75.75 0 001.33 0l1.713-3.293a.783.783 0 01.642-.413 41.102 41.102 0 003.55-.414c1.437-.231 2.43-1.49 2.43-2.902V5.426c0-1.413-.993-2.67-2.43-2.902A41.289 41.289 0 0010 2zM6.75 6a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 2.5a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5z"
                        clip-rule="evenodd"
                      ></path></svg
                  ></a>
                </div>
              </header>
              <div style="margin: 4rem 0" class="flow">
                <p>
                  Cypress is a tool for automatically running your tests in a
                  real web browser. Lots of testing libraries run using Node in
                  your terminal. This means they struggle to test real user
                  interactions with the DOM (since Node doesn’t have one).
                </p>
                <p>
                  You can test in the browser by manually including test
                  functions in a script tag on the page. However this isn’t
                  ideal as you have to remember to remove them from your
                  production deployment (or all your users can see your test
                  results in the console).
                </p>
                <p>
                  Cypress solves this problem by letting you write separate test
                  files, then injecting them into a real browser. Since it
                  automatically controls a browser you can see your tests
                  running in in real time.
                </p>
                <h2 id="setup">
                  Setup
                  <a class="heading-anchor" href="#setup">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h2>
                <p>
                  First we need to create a new directory and initialise it so
                  we can install modules:
                </p>
                <pre
                  class="language-shell"
                ><code class="language-shell"><span class="token function">mkdir</span> cypress-testing<br><span class="token builtin class-name">cd</span> cypress-testing<br><span class="token function">npm</span> init <span class="token parameter variable">-y</span></code></pre>
                <div class="box box-default content flow">
                  <h3 id="linux-users">
                    Linux users
                    <a class="heading-anchor" href="#linux-users">
                      <svg
                        viewBox="0 0 32 32"
                        width="20"
                        height="20"
                        fill="none"
                        stroke="currentcolor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                      >
                        <path
                          d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                        ></path>
                      </svg>
                    </a>
                  </h3>
                  <p>
                    If you’re on Linux you may need to install additional
                    dependencies. You can find the commands you need
                    <a
                      href="https://docs.cypress.io/guides/getting-started/installing-cypress#Linux"
                      >in Cypress’s docs</a
                    >.
                  </p>
                </div>
                <p>
                  Once you’re inside your new directory and have generated a
                  <code>package.json</code> file you can install Cypress as a
                  dev dependency:
                </p>
                <pre
                  class="language-shell"
                ><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> cypress</code></pre>
                <p>
                  Cypress can take a while to install the first time, so be
                  patient. Once it’s finished open your
                  <code>package.json</code> and edit the
                  <code>&quot;test&quot;</code> script to this command:
                </p>
                <pre
                  class="language-json"
                ><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"cypress open"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
                <p>
                  Run <code>npm run test</code> in your terminal, and you should
                  see the Cypress app start up. The window will show a bunch of
                  example tests—don’t worry about these for now.
                </p>
                <p>
                  The first time you run Cypress it automatically creates some
                  files. You should see a <code>cypress.json</code> file and a
                  <code>cypress/</code> directory full of examples. The JSON
                  file is used to configure Cypress—you can leave it empty for
                  now.
                </p>
                <p>Now you’re ready to write your first test.</p>
                <h2 id="your-first-cypress-test">
                  Your first Cypress test
                  <a class="heading-anchor" href="#your-first-cypress-test">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h2>
                <p>
                  By default Cypress looks in the
                  <code>cypress/integration/</code> directory for test files. It
                  will run anything inside this folder. You can delete the
                  auto-generated <code>example/</code> folder, since we’re going
                  to start from scratch.
                </p>
                <p>
                  Create a new file called <code>practice-tests.js</code>. You
                  should see this file show up in the Cypress app under
                  “Integration tests”.
                </p>
                <figure>
                  <img
                    src="images/cypress-start.png"
                    alt="The Cypress app window showing just our new test file: practice-tests.js"
                  />
                  <figcaption>The Cypress app showing a single test</figcaption>
                </figure>
                <p>
                  You can click the file name to run it with Cypress. This
                  should open up a browser with a “test sidebar” on the left.
                  Since we didn’t actually write any tests yet it’ll say “No
                  tests found”.
                </p>
                <p>Let’s add a simple test to the file:</p>
                <pre
                  class="language-js"
                ><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"can run a test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  Cypress uses a global <code>it</code> function to define
                  tests. This works just like the <code>test</code> function we
                  wrote in the
                  <a href="/workshops/learn-testing/">intro to testing</a>
                  workshop—it just has a different name.
                </p>
                <p>
                  If you save your test file Cypress should automatically re-run
                  the test. It will now find the test and show the result in the
                  sidebar.
                </p>
                <figure>
                  <img
                    src="images/cypress-first-test.png"
                    alt="My Edge browser being controlled by Cypress. It shows our passing test in the sidebar on the left."
                  />
                  <figcaption>My browser running our first test</figcaption>
                </figure>
                <p>
                  This is a fine way to write simple unit tests, but Cypress is
                  much more powerful. Let’s test a real web page.
                </p>
                <p>Add a new test function:</p>
                <pre
                  class="language-js"
                ><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"can navigate pages"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">"https://example.cypress.io/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  We’re using the global <code>cy</code> object to run a
                  “command”. <code>cy.visit</code> tells Cypress to load a URL
                  in the browser and wait for the page to load.
                </p>
                <p>
                  You should see the test re-run in your Cypress browser. The
                  right side should load Cypress’ example app (called “Kitchen
                  Sink”).
                </p>
                <p>Let’s add a command to find an element on the page:</p>
                <pre
                  class="language-js"
                ><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"can navigate pages"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">"https://example.cypress.io/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"within"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  <code>cy.contains</code> will search the text content of all
                  elements until it finds a match. If you click this test in the
                  sidebar you should see the “Test body” table. Hover the
                  <code>contains</code> command and the browser on the right
                  will update to highlight the element it found.
                </p>
                <p>
                  If a Cypress command <em>fails</em> it will cause the test to
                  fail. For example change your test to search for an element
                  containing <code>&quot;zzzzzz&quot;</code>. You should see an
                  error message in the sidebar.
                </p>
                <figure>
                  <img
                    src="images/failed-test.png"
                    alt="Cypress has highlighted the failing test in red in the sidebar. It includes a message telling us that it couldn't find the expected text content after a 4 second wait."
                  />
                  <figcaption>A failed test in the sidebar</figcaption>
                </figure>
                <p>Now let’s interact with this element in our test:</p>
                <pre
                  class="language-js"
                ><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"can navigate pages"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">"https://example.cypress.io/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"within"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  This will tell Cypress to click the link. You should see the
                  test re-run, and the browser navigate to the “Querying” page.
                </p>
                <p>
                  Finally we can make an assertion about the new page to verify
                  that we got to the right place:
                </p>
                <pre
                  class="language-js"
                ><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"can navigate pages"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">"https://example.cypress.io/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cy<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"within"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  cy<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">"include"</span><span class="token punctuation">,</span> <span class="token string">"/commands/querying"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  This syntax is a little strange at first, but it’s supposed to
                  read like a sentence. The <code>cy.url</code> method retrieves
                  the current URL. The <code>.should</code> method creates an
                  assertion. Here we are checking that the URL includes the
                  sub-string “/commands/querying”.
                </p>
                <p>
                  That’s it—we’ve created a full integration test with Cypress.
                  It’s important to note that we aren’t limited to a single set
                  of tasks in a test. We can keep adding more commands in here
                  until we’re satisfied.
                </p>
                <h2 id="cypress-commands">
                  Cypress commands
                  <a class="heading-anchor" href="#cypress-commands">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h2>
                <p>
                  You can find a full set of available commands at
                  <a href="https://example.cypress.io/"
                    >https://example.cypress.io/</a
                  >. Here’s a quick example with a few new ones that will
                  useful:
                </p>
                <pre
                  class="language-js"
                ><code class="language-js">cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"#signup-form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"input[name='email']"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"my-email@test.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"#signup-form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
                <p>
                  Here we’re getting the sign up form, finding the email input
                  within it, then typing an email into that input. Finally we
                  get the form again and submit it.
                </p>
                <p>
                  <code>cy.get</code> takes a CSS selector to find an element,
                  just like <code>querySelector</code> in the DOM.
                  <code>.find</code> works the same way, but it searches the
                  <em>children</em> of an element. <code>.type</code> simulates
                  typing text via the keyboard. <code>.submit</code> triggers a
                  form submission.
                </p>
                <div class="box box-default content flow">
                  <p>
                    <strong>Note</strong>: normal <code>console.log</code>s
                    won’t show up in the Cypress sidebar. The easiest way to
                    debug things is to use the
                    <a href="https://docs.cypress.io/api/commands/log"
                      ><code>cy.log</code></a
                    >
                    command.
                  </p>
                </div>
                <h2 id="workshop">
                  Workshop
                  <a class="heading-anchor" href="#workshop">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h2>
                <p>
                  You’re going to use Cypress to build a server TDD-style. That
                  means write a failing test for each feature first, then
                  implement that feature to make the test pass.
                </p>
                <h3 id="quick-setup">
                  Quick setup
                  <a class="heading-anchor" href="#quick-setup">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h3>
                <ol>
                  <li>Create a <code>server.js</code> file</li>
                  <li><code>npm install express</code></li>
                  <li>
                    <code>npm install -D nodemon</code> (for auto-restarting the
                    server)
                  </li>
                  <li>
                    Add a “dev” npm script of: <code>nodemon server.js</code>
                  </li>
                </ol>
                <p>
                  Write your Express server in <code>server.js</code>. Write
                  your tests in <code>cypress/integration/</code>.
                </p>
                <div class="box box-default content flow">
                  <p>
                    <strong>Note</strong>: make sure your server is running
                    before you start Cypress, otherwise it won’t be able to find
                    the localhost address.
                  </p>
                </div>
                <h3 id="requirements-for-your-server">
                  Requirements for your server
                  <a
                    class="heading-anchor"
                    href="#requirements-for-your-server"
                  >
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h3>
                <ul>
                  <li>
                    <code>/</code> page with a title of “Welcome to my site”
                  </li>
                  <li>
                    <code>/</code> page has working links to
                    <code>/about</code> and <code>/sign-up</code>
                  </li>
                  <li>
                    <code>/about</code> page with a title of “About this site”
                  </li>
                  <li>
                    <code>/sign-up</code> page with a form containing
                    email/password inputs
                  </li>
                  <li>
                    <code>/welcome</code> page with a title of “Thanks for
                    joining”
                  </li>
                  <li>
                    <code>/sign-up</code> page redirects to
                    <code>/welcome</code> after form submission (don’t worry
                    about actually using the submitted data)
                  </li>
                </ul>
                <h3 id="stretch-goal">
                  Stretch goal
                  <a class="heading-anchor" href="#stretch-goal">
                    <svg
                      viewBox="0 0 32 32"
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentcolor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        d="M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15"
                      ></path>
                    </svg>
                  </a>
                </h3>
                <p>
                  If you have spare time go back to the
                  <a href="/workshops/server-side-forms/"
                    >server-side forms workshop</a
                  >. Use Cypress to write tests for your solution to verify that
                  it works correctly
                </p>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>
    <script type="module" src="/assets/js/checkboxen.js"></script>
    <script src="/assets/js/toggle-button.js"></script>
    <script src="/assets/js/copy-text.js"></script>
  </body>
</html>
